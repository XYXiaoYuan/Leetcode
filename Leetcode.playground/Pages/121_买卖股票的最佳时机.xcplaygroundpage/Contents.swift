/**
 https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/
 
 ç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå®ƒçš„ç¬¬Â i ä¸ªå…ƒç´ Â prices[i] è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚

 ä½ åªèƒ½é€‰æ‹© æŸä¸€å¤© ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨ æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­ å–å‡ºè¯¥è‚¡ç¥¨ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚

 è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› 0 ã€‚

 Â 

 ç¤ºä¾‹ 1ï¼š

 è¾“å…¥ï¼š[7,1,5,3,6,4]
 è¾“å‡ºï¼š5
 è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ = 6-1 = 5 ã€‚
      æ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ 7-1 = 6, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ï¼›åŒæ—¶ï¼Œä½ ä¸èƒ½åœ¨ä¹°å…¥å‰å–å‡ºè‚¡ç¥¨ã€‚
 ç¤ºä¾‹ 2ï¼š

 è¾“å…¥ï¼šprices = [7,6,4,3,1]
 è¾“å‡ºï¼š0
 è§£é‡Šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚


 æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰
 é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock
 è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
 */

/**
 è‚¡ç¥¨é—®é¢˜å›¢ç­
 
 æ¯å¤©éƒ½æœ‰ä¸‰ç§ã€Œé€‰æ‹©ã€ï¼šä¹°â¼Šã€å–å‡ºã€â½†æ“ä½œï¼Œæˆ‘ä»¬â½¤ buy, sell, rest è¡¨â½°è¿™ä¸‰ç§é€‰æ‹©ã€‚ä½†é—®é¢˜æ˜¯ï¼Œå¹¶ä¸æ˜¯æ¯å¤©éƒ½å¯ä»¥ä»»æ„é€‰æ‹©è¿™ä¸‰ ç§é€‰æ‹©çš„ï¼Œå› ä¸º sell å¿…é¡»åœ¨ buy ä¹‹åï¼Œbuy å¿…é¡»åœ¨ sell ä¹‹åã€‚é‚£ä¹ˆ rest æ“ä½œ è¿˜åº”è¯¥åˆ†ä¸¤ç§çŠ¶æ€ï¼Œâ¼€ç§æ˜¯ buy ä¹‹åçš„ restï¼ˆæŒæœ‰äº†è‚¡ç¥¨ï¼‰ï¼Œâ¼€ç§æ˜¯ sell ä¹‹ åçš„ restï¼ˆæ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼‰ã€‚â½½ä¸”åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬è¿˜æœ‰äº¤æ˜“æ¬¡æ•° k çš„é™åˆ¶ï¼Œå°± æ˜¯è¯´ä½  buy è¿˜åªèƒ½åœ¨ k > 0 çš„å‰æä¸‹æ“ä½œã€‚ å¾ˆå¤æ‚å¯¹å§ï¼Œä¸è¦æ€•ï¼Œæˆ‘ä»¬ç°åœ¨çš„â½¬çš„åªæ˜¯ç©·ä¸¾ï¼Œä½ æœ‰å†å¤šçš„çŠ¶æ€ï¼Œâ½¼å¤«è¦ åšçš„å°±æ˜¯â¼€æŠŠæ¢­å…¨éƒ¨åˆ—ä¸¾å‡ºæ¥ã€‚è¿™ä¸ªé—®é¢˜çš„ã€ŒçŠ¶æ€ã€æœ‰ä¸‰ä¸ªï¼Œç¬¬â¼€ä¸ªæ˜¯å¤© æ•°ï¼Œç¬¬â¼†ä¸ªæ˜¯å…è®¸äº¤æ˜“çš„æœ€â¼¤æ¬¡æ•°ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å½“å‰çš„æŒæœ‰çŠ¶æ€ï¼ˆå³ä¹‹å‰è¯´çš„ rest çš„çŠ¶æ€ï¼Œæˆ‘ä»¬ä¸å¦¨â½¤ 1 è¡¨â½°æŒæœ‰ï¼Œ0 è¡¨â½°æ²¡æœ‰æŒæœ‰ï¼‰ã€‚ç„¶åæˆ‘ä»¬â½¤â¼€ä¸ª ä¸‰ç»´æ•°ç»„å°±å¯ä»¥è£…ä¸‹è¿™â¼ç§çŠ¶æ€çš„å…¨éƒ¨ç»„åˆï¼š
 
 dp[i][k][0 or 1]
 0 <= i <= n-1, 1 <= k <= K
 n ä¸ºå¤©æ•°ï¼Œâ¼¤ K ä¸ºæœ€å¤šäº¤æ˜“æ•°
 æ­¤é—®é¢˜å…± n Ã— K Ã— 2 ç§çŠ¶æ€ï¼Œå…¨éƒ¨ç©·ä¸¾å°±èƒ½æå®šã€‚
 for 0 <= i < n:
     for 1 <= k <= K:
         for s in {0, 1}:
             dp[i][k][s] = max(buy, sell, rest)
 
 â½½ä¸”æˆ‘ä»¬å¯ä»¥â½¤â¾ƒç„¶è¯­â¾”æè¿°å‡ºæ¯â¼€ä¸ªçŠ¶æ€çš„å«ä¹‰ï¼Œâ½å¦‚è¯´ dp[3][2][1] çš„å«ä¹‰å°±æ˜¯ï¼šä»Šå¤©æ˜¯ç¬¬ä¸‰å¤©ï¼Œæˆ‘ç°åœ¨â¼¿ä¸ŠæŒæœ‰ç€è‚¡ç¥¨ï¼Œâ¾„ä»Šæœ€å¤šè¿›â¾ 2 æ¬¡äº¤ æ˜“ã€‚å†â½å¦‚ dp[2][3][0] çš„å«ä¹‰ï¼šä»Šå¤©æ˜¯ç¬¬â¼†å¤©ï¼Œæˆ‘ç°åœ¨â¼¿ä¸Šæ²¡æœ‰æŒæœ‰è‚¡ ç¥¨ï¼Œâ¾„ä»Šæœ€å¤šè¿›â¾ 3 æ¬¡äº¤æ˜“ã€‚å¾ˆå®¹æ˜“ç†è§£ï¼Œå¯¹å§ï¼Ÿ æˆ‘ä»¬æƒ³æ±‚çš„æœ€ç»ˆç­”æ¡ˆæ˜¯ dp[n - 1][K][0]ï¼Œå³æœ€åâ¼€å¤©ï¼Œæœ€å¤šå…è®¸ K æ¬¡äº¤æ˜“ï¼Œ æœ€å¤šè·å¾—å¤šå°‘åˆ©æ¶¦ã€‚è¯»è€…å¯èƒ½é—®ä¸ºä»€ä¹ˆä¸æ˜¯ dp[n - 1][K][1]ï¼Ÿå› ä¸º [1] ä»£è¡¨â¼¿ ä¸Šè¿˜æŒæœ‰è‚¡ç¥¨ï¼Œ[0] è¡¨â½°â¼¿ä¸Šçš„è‚¡ç¥¨å·²ç»å–å‡ºå»äº†ï¼Œå¾ˆæ˜¾ç„¶åè€…å¾—åˆ°çš„åˆ©æ¶¦ â¼€å®šâ¼¤äºå‰è€…ã€‚ è®°ä½å¦‚ä½•è§£é‡Šã€ŒçŠ¶æ€ã€ï¼Œâ¼€æ—¦ä½ è§‰å¾—å“ªâ¾¥ä¸å¥½ç†è§£ï¼ŒæŠŠå®ƒç¿»è¯‘æˆâ¾ƒç„¶è¯­â¾”å°± å®¹æ˜“ç†è§£äº†ã€‚
 
 dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i])
               max( é€‰æ‹© rest , é€‰æ‹© sell )
 è§£é‡Šï¼šä»Šå¤©æˆ‘æ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼š è¦ä¹ˆæ˜¯æˆ‘æ˜¨å¤©å°±æ²¡æœ‰æŒæœ‰ï¼Œç„¶åä»Šå¤©é€‰æ‹© restï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©è¿˜æ˜¯æ²¡æœ‰æŒæœ‰ï¼› è¦ä¹ˆæ˜¯æˆ‘æ˜¨å¤©æŒæœ‰è‚¡ç¥¨ï¼Œä½†æ˜¯ä»Šå¤©æˆ‘ sell äº†ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©æ²¡æœ‰æŒæœ‰è‚¡ç¥¨äº†ã€‚
 
 dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i])
               max( é€‰æ‹© rest , é€‰æ‹© buy )
 è§£é‡Šï¼šä»Šå¤©æˆ‘æŒæœ‰ç€è‚¡ç¥¨ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼š è¦ä¹ˆæˆ‘æ˜¨å¤©å°±æŒæœ‰ç€è‚¡ç¥¨ï¼Œç„¶åä»Šå¤©é€‰æ‹© restï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©è¿˜æŒæœ‰ç€è‚¡ç¥¨ï¼› è¦ä¹ˆæˆ‘æ˜¨å¤©æœ¬æ²¡æœ‰æŒæœ‰ï¼Œä½†ä»Šå¤©æˆ‘é€‰æ‹© buyï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘å°±æŒæœ‰è‚¡ç¥¨äº†ã€‚
 */

/**
 k = 1 ç›´æ¥å¥—çŠ¶æ€è½¬ç§»â½…ç¨‹ï¼Œæ ¹æ® base caseï¼Œå¯ä»¥åšâ¼€äº›åŒ–ç®€ï¼š
 dp[i][1][0] = max(dp[i-1][1][0], dp[i-1][1][1] + prices[i])
 dp[i][1][1] = max(dp[i-1][1][1], dp[i-1][0][0] - prices[i])
           = max(dp[i-1][1][1], -prices[i])
 
 è§£é‡Šï¼šk = 0 çš„ base caseï¼Œæ‰€ä»¥ dp[i-1][0][0] = 0ã€‚
 ç°åœ¨å‘ç° k éƒ½æ˜¯ 1ï¼Œä¸ä¼šæ”¹å˜ï¼Œå³ k å¯¹çŠ¶æ€è½¬ç§»å·²ç»æ²¡æœ‰å½±å“äº†ã€‚
 å¯ä»¥è¿›â¾è¿›â¼€æ­¥åŒ–ç®€å»æ‰æ‰€æœ‰ kï¼š
 dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])
 dp[i][1] = max(dp[i-1][1], -prices[i])
 */
class Solution {
    func maxProfit(_ prices: [Int]) -> Int {
        if prices.isEmpty {
            return 0
        }
        
        // å‰é¢æ‰«æè¿‡çš„æœ€å°ä»·æ ¼
        var minPrice = prices[0]
        
        // å‰åœ¨æ‰«æè¿‡çš„æœ€å¤§åˆ©æ¶¦
        var maxProfit = 0
        
        // æ‰«ææ‰€æœ‰çš„ä»·æ ¼
        for i in 1..<prices.count {
            if prices[i] < minPrice {
                minPrice = prices[i]
            } else {
                maxProfit = max(maxProfit, prices[i] - minPrice)
            }
        }
        
        return maxProfit
    }
    
    func maxProfit2(_ prices: [Int]) -> Int {
        if prices.isEmpty {
            return 0
        }
        
        let n = prices.count
        
        var dp_i_0 = 0
        var dp_i_1 = Int.min
        
        for i in 0..<n {
            dp_i_0 = max(dp_i_0, dp_i_1 + prices[i])
            dp_i_1 = max(dp_i_1, -prices[i])
        }
        return dp_i_0
    }
    
    func maxProfit1(_ prices: [Int]) -> Int {
        if prices.isEmpty {
            return 0
        }
        
        let n = prices.count
        var dp: [[Int]] = [[Int]].init(repeating: [Int].init(repeating: 0, count: 2), count: n)
        
        for i in 0..<n {
            if i - 1 == -1 {
                dp[i][0] = 0
                dp[i][1] = -prices[i]
                continue
            }
            dp[i][0] = max(dp[i - 1][0], dp[i - 1][1] + prices[i])
            dp[i][1] = max(dp[i - 1][1], -prices[i])
        }
        
        return dp[n - 1][0]
    }
}

let s = Solution()
let input1 = [7,1,5,3,6,4]
let input2 = [7,6,4,3,1]
let result = s.maxProfit(input1)
print(result)

assert(s.maxProfit(input1) == 5)
assert(s.maxProfit(input2) == 0)

/// å…¨å±€æ‰“å°,å‘å¸ƒæ—¶ä¸è§¦å‘, isDebug == falseæ—¶ä¸æ‰“å°
public func print<T>(_ msg: T,
                     line: Int = #line) {
    let prefix = "ğŸ·_\(line)"
    print(prefix, msg)
}

